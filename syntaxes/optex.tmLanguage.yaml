---
name: OpTeX
scopeName: source.optex
patterns:
  - include: "#comments"
  - include: "#declarations"
  - include: "#keywords"
  - include: "#markup"
  - include: "#functions"
repository:
  keywords:
    patterns:
      # plaintex keywords
      - name: keyword.control
        match: (\\)(backmatter|csname|else|endcsname|fi|frontmatter|mainmatter|unless|if(case|cat|csname|defined|dim|eof|false|fontchar|hbox|hmode|inner|mmode|num|odd|true|vbox|vmode|void|x)?)
  comments:
    patterns:
      - name: comment.line.percentage
        begin: "%"
        end: "\n"
      - name: comment.block.documentation
        begin: \\_doc
        end: \\_cod
        patterns:
          - include: "#documentationFunctions"
  markup:
    patterns:
      - name: markup.raw
        begin: "`"
        end: "`"
  declarations:
    patterns:
      - name: entity.name.function
        match: (\\)_?(def)\s*(\\)_?(\p{Alphabetic}+)((#[1-9])*)
        captures:
          '2': 
            name: keyword.control
          '4':
            name: entity.name.function
          '5': 
            name: variable.parameter
  functions:
    patterns:
      - name: entity.name.function
        match: \\(\p{Alphabetic})+
      - name: support.function
        match: \\_(\p{Alphabetic})+

  documentationFunctions:
    patterns:
      - name: entity.name.function
        match: \\(\^|~)?\`\\(\p{Alphabetic})+\`